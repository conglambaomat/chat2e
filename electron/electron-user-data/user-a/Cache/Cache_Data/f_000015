import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/components/Message.jsx");import __vite__cjsImport0_react_jsxDevRuntime from "/node_modules/.vite/deps/react_jsx-dev-runtime.js?v=3e05e836"; const jsxDEV = __vite__cjsImport0_react_jsxDevRuntime["jsxDEV"];
import RefreshRuntime from "/@react-refresh";
const inWebWorker = typeof WorkerGlobalScope !== "undefined" && self instanceof WorkerGlobalScope;
let prevRefreshReg;
let prevRefreshSig;
if (import.meta.hot && !inWebWorker) {
  if (!window.__vite_plugin_react_preamble_installed__) {
    throw new Error("@vitejs/plugin-react can't detect preamble. Something is wrong. See https://github.com/vitejs/vite-plugin-react/pull/11#discussion_r430879201");
  }
  prevRefreshReg = window.$RefreshReg$;
  prevRefreshSig = window.$RefreshSig$;
  window.$RefreshReg$ = (type, id) => {
    RefreshRuntime.register(type, "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx " + id);
  };
  window.$RefreshSig$ = RefreshRuntime.createSignatureFunctionForTransform;
}
var _s = $RefreshSig$();
import __vite__cjsImport3_react from "/node_modules/.vite/deps/react.js?v=3e05e836"; const useEffect = __vite__cjsImport3_react["useEffect"]; const useState = __vite__cjsImport3_react["useState"]; const useMemo = __vite__cjsImport3_react["useMemo"]; const useCallback = __vite__cjsImport3_react["useCallback"];
import { useAuthStore } from "/src/store/useAuthStore.js";
import { useChatStore } from "/src/store/useChatStore.js";
import { arrayBufferToBase64, base64ToArrayBuffer, formatMessageTime } from "/src/lib/utils.js";
import JSEncrypt from "/node_modules/.vite/deps/jsencrypt.js?v=3e05e836";
import toast from "/node_modules/.vite/deps/react-hot-toast.js?v=3e05e836";
import { Loader, Download, FileText, FileWarning, Trash2 } from "/node_modules/.vite/deps/lucide-react.js?v=3e05e836";
import DecryptedMessageContent from "/src/components/DecryptedMessageContent.jsx";
const formatFileSize = (bytes) => {
  if (bytes === 0) return "0 Bytes";
  const k = 1024;
  const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + " " + sizes[i];
};
const Message = ({ message }) => {
  _s();
  const authUser = useAuthStore((state) => state.authUser);
  const privateKey = useAuthStore((state) => state.privateKey);
  const selectedUser = useChatStore((state) => state.selectedUser);
  const selectedMessageId = useChatStore((state) => state.selectedMessageId);
  const setSelectedMessageId = useChatStore((state) => state.setSelectedMessageId);
  const deleteMessage = useChatStore((state) => state.deleteMessage);
  const [isDownloading, setIsDownloading] = useState(false);
  const isSender = message.senderId === authUser?._id;
  const chatClassName = isSender ? "chat-end" : "chat-start";
  const bubbleBgColor = isSender ? "bg-sky-500" : "bg-gray-600";
  const profilePic = isSender ? authUser?.profilePic : selectedUser?.profilePic;
  const formattedTime = formatMessageTime(message.createdAt);
  const isSelected = selectedMessageId === message._id;
  console.log(`[Message ${message._id}] Render. isSender: ${isSender}, selectedMessageId: ${selectedMessageId}, isSelected: ${isSelected}`);
  const handleMessageClick = useCallback(() => {
    console.log(`[Message ${message._id}] handleMessageClick fired. isSender: ${isSender}`);
    if (isSender) {
      setSelectedMessageId(message._id);
    } else {
      setSelectedMessageId(null);
      console.log(`[Message ${message._id}] Clicked received message, clearing selection.`);
    }
  }, [message._id, isSender, setSelectedMessageId]);
  const handleDeleteClick = useCallback((e) => {
    e.stopPropagation();
    console.log(`[Message ${message._id}] handleDeleteClick fired.`);
    if (window.confirm("Are you sure you want to delete this message?")) {
      deleteMessage(message._id);
    }
  }, [message._id, deleteMessage]);
  const handleDownloadFile = useCallback(async () => {
    setSelectedMessageId(null);
    if (!message.is_file || !privateKey) {
      toast.error("Cannot download file: Information missing or no private key.");
      return;
    }
    setIsDownloading(true);
    const loadingToastId = toast.loading("Starting download...");
    let encryptedAesKeyBase64 = null;
    let decryptedAesKeyBase64 = null;
    let fileAesKey = null;
    try {
      console.log(`[handleDownloadFile] Checking keys for message ${message._id}:`);
      console.log(`  -> isSender: ${isSender} (authUser: ${authUser?._id}, msgSender: ${message.senderId})`);
      console.log(`  -> message.file_encrypted_key (for receiver):`, message.file_encrypted_key ? message.file_encrypted_key.substring(0, 30) + "..." : "MISSING/NULL");
      console.log(`  -> message.file_encrypted_key_sender (for sender):`, message.file_encrypted_key_sender ? message.file_encrypted_key_sender.substring(0, 30) + "..." : "MISSING/NULL");
      encryptedAesKeyBase64 = isSender ? message.file_encrypted_key_sender : message.file_encrypted_key;
      console.log(`[handleDownloadFile] Assigned encryptedAesKeyBase64 = ${encryptedAesKeyBase64 ? encryptedAesKeyBase64.substring(0, 30) + "..." : "FALSY"}`);
      if (!encryptedAesKeyBase64) {
        throw new Error("Missing encrypted AES key for the file.");
      }
      const decryptor = new JSEncrypt();
      decryptor.setPrivateKey(privateKey);
      decryptedAesKeyBase64 = decryptor.decrypt(encryptedAesKeyBase64);
      if (decryptedAesKeyBase64 === false || decryptedAesKeyBase64 === null) {
        console.error(`[handleDownloadFile] RSA Decryption FAILED! decrypt() returned: ${decryptedAesKeyBase64}`);
        throw new Error("RSA Decryption Failed. Cannot retrieve AES key.");
      }
      const aesKeyBuffer = base64ToArrayBuffer(decryptedAesKeyBase64);
      fileAesKey = await crypto.subtle.importKey(
        "raw",
        aesKeyBuffer,
        { name: "AES-GCM" },
        true,
        ["decrypt"]
      );
      console.log("[handleDownloadFile] Imported fileAesKey object:", fileAesKey);
      console.log("[handleDownloadFile] Decrypted AES Key (Base64 for import):", decryptedAesKeyBase64);
      if (!message.file_iv) {
        throw new Error("Missing file IV in message data.");
      }
      console.log("[handleDownloadFile] File IV (Base64 from message.file_iv):");
      console.log(message.file_iv);
      const fileIv = base64ToArrayBuffer(message.file_iv);
      console.log("[handleDownloadFile] File IV ArrayBuffer length:", fileIv.byteLength);
      toast.loading("Downloading encrypted file...", { id: loadingToastId });
      const response = await fetch(`/api/files/download/${message.file_path}`, {
        credentials: "include"
      });
      const contentType = response.headers.get("content-type");
      console.log("[handleDownloadFile] Response headers:", {
        status: response.status,
        statusText: response.statusText,
        contentType,
        contentLength: response.headers.get("content-length")
      });
      if (!response.ok) {
        const errorText = await response.text();
        console.error("[handleDownloadFile] Server error response:", {
          status: response.status,
          statusText: response.statusText,
          responseText: errorText.substring(0, 200) + "..."
        });
        throw new Error(`Server returned error: ${response.status} ${response.statusText}`);
      }
      if (!contentType) {
        console.warn("[handleDownloadFile] Missing content-type header");
      } else if (!contentType.includes("application/octet-stream")) {
        console.warn(`[handleDownloadFile] Unexpected content-type: ${contentType}, but proceeding anyway`);
      }
      const encryptedFileBuffer = await response.arrayBuffer();
      console.log("[handleDownloadFile] Encrypted file buffer size:", encryptedFileBuffer.byteLength);
      const downloadedBytes = new Uint8Array(encryptedFileBuffer);
      console.log(`[handleDownloadFile] Downloaded Buffer (${downloadedBytes.length} bytes) Start:`, downloadedBytes.slice(0, 16));
      console.log(`[handleDownloadFile] Downloaded Buffer End:`, downloadedBytes.slice(-16));
      const firstBytesStr = String.fromCharCode.apply(null, downloadedBytes.slice(0, 20));
      if (firstBytesStr.includes("<!DOCTYPE") || firstBytesStr.includes("<html")) {
        console.error("[handleDownloadFile] Received HTML instead of binary data:", firstBytesStr);
        throw new Error("Server returned HTML instead of file data. Please check server logs.");
      }
      toast.loading("Decrypting file...", { id: loadingToastId });
      console.log("[handleDownloadFile] Attempting crypto.subtle.decrypt...");
      const decryptedFileBuffer = await crypto.subtle.decrypt(
        { name: "AES-GCM", iv: fileIv },
        fileAesKey,
        encryptedFileBuffer
      );
      const blob = new Blob([decryptedFileBuffer], { type: message.file_type || "application/octet-stream" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = message.original_file_name || "downloaded_file";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      toast.success("File downloaded and decrypted!", { id: loadingToastId });
    } catch (error) {
      console.error("--- Error downloading/decrypting file ---");
      if (error instanceof Error) {
        console.error("Error Name:", error.name);
        console.error("Error Message:", error.message);
        console.error("Message ID:", message._id);
        console.error("Used Decrypted AES Key (Base64):", decryptedAesKeyBase64);
        console.error("Imported fileAesKey object (at time of error):", fileAesKey);
        console.error("Used IV (Base64 from msg.file_iv):", message.file_iv);
        console.error("Error Stack:", error.stack);
        toast.error(`Download failed: ${error.name} - ${error.message}`, { id: loadingToastId });
      } else {
        console.error("Caught non-Error object:", error);
        toast.error(`Download failed due to an unexpected error. Check console.`, { id: loadingToastId });
      }
      console.error("--- End Error Details ---");
    } finally {
      setIsDownloading(false);
      setSelectedMessageId(null);
    }
  }, [message, privateKey, isSender, setSelectedMessageId]);
  return /* @__PURE__ */ jsxDEV(
    "div",
    {
      className: `chat ${chatClassName} relative group ${isSender ? "cursor-pointer" : ""}`,
      onClick: handleMessageClick,
      children: [
        isSender && isSelected && /* @__PURE__ */ jsxDEV(
          "button",
          {
            onClick: handleDeleteClick,
            className: `absolute ${isSender ? "right-[calc(2.5rem+0.5rem)]" : "left-[calc(2.5rem+0.5rem)]"} top-1/2 transform -translate-y-1/2
                               p-1.5 rounded-full bg-red-500 hover:bg-red-600 text-white
                               opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10`,
            title: "Delete Message",
            children: /* @__PURE__ */ jsxDEV(Trash2, { size: 18 }, void 0, false, {
              fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
              lineNumber: 228,
              columnNumber: 21
            }, this)
          },
          void 0,
          false,
          {
            fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
            lineNumber: 220,
            columnNumber: 7
          },
          this
        ),
        /* @__PURE__ */ jsxDEV("div", { className: "chat-image avatar", children: /* @__PURE__ */ jsxDEV("div", { className: "w-10 rounded-full", children: /* @__PURE__ */ jsxDEV("img", { alt: "User avatar", src: profilePic || "/avatar.png" }, void 0, false, {
          fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
          lineNumber: 234,
          columnNumber: 21
        }, this) }, void 0, false, {
          fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
          lineNumber: 233,
          columnNumber: 17
        }, this) }, void 0, false, {
          fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
          lineNumber: 232,
          columnNumber: 13
        }, this),
        /* @__PURE__ */ jsxDEV("div", { className: `chat-bubble ${bubbleBgColor} text-white pb-2 px-3 break-words`, children: message.is_file === true ? /* @__PURE__ */ jsxDEV("div", { className: "flex items-center gap-3 p-2", children: [
          /* @__PURE__ */ jsxDEV("button", { onClick: !isDownloading ? handleDownloadFile : void 0, disabled: isDownloading, className: "flex-shrink-0 p-1 rounded hover:bg-black/20", children: isDownloading ? /* @__PURE__ */ jsxDEV(Loader, { className: "size-6 animate-spin" }, void 0, false, {
            fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
            lineNumber: 243,
            columnNumber: 13
          }, this) : /* @__PURE__ */ jsxDEV(Download, { className: "size-6 text-sky-300" }, void 0, false, {
            fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
            lineNumber: 245,
            columnNumber: 13
          }, this) }, void 0, false, {
            fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
            lineNumber: 241,
            columnNumber: 25
          }, this),
          /* @__PURE__ */ jsxDEV("div", { className: "flex flex-col overflow-hidden", children: [
            /* @__PURE__ */ jsxDEV("span", { className: "text-sm font-medium truncate", title: message.original_file_name, children: message.original_file_name || "Attached File" }, void 0, false, {
              fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
              lineNumber: 249,
              columnNumber: 29
            }, this),
            /* @__PURE__ */ jsxDEV("span", { className: "text-xs opacity-70", children: formatFileSize(message.file_size || 0) }, void 0, false, {
              fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
              lineNumber: 252,
              columnNumber: 29
            }, this)
          ] }, void 0, true, {
            fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
            lineNumber: 248,
            columnNumber: 25
          }, this)
        ] }, void 0, true, {
          fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
          lineNumber: 240,
          columnNumber: 9
        }, this) : /* @__PURE__ */ jsxDEV(
          DecryptedMessageContent,
          {
            message,
            privateKey,
            isSender
          },
          void 0,
          false,
          {
            fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
            lineNumber: 259,
            columnNumber: 9
          },
          this
        ) }, void 0, false, {
          fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
          lineNumber: 237,
          columnNumber: 13
        }, this),
        /* @__PURE__ */ jsxDEV("div", { className: "chat-footer opacity-50 text-xs flex gap-1 items-center mt-1", children: formattedTime }, void 0, false, {
          fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
          lineNumber: 266,
          columnNumber: 13
        }, this)
      ]
    },
    void 0,
    true,
    {
      fileName: "E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx",
      lineNumber: 214,
      columnNumber: 5
    },
    this
  );
};
_s(Message, "tHXX9gvKS3N9jkyPiW5JV8WYg9c=", false, function() {
  return [useAuthStore, useAuthStore, useChatStore, useChatStore, useChatStore, useChatStore];
});
_c = Message;
export default Message;
var _c;
$RefreshReg$(_c, "Message");
if (import.meta.hot && !inWebWorker) {
  window.$RefreshReg$ = prevRefreshReg;
  window.$RefreshSig$ = prevRefreshSig;
}
if (import.meta.hot && !inWebWorker) {
  RefreshRuntime.__hmr_import(import.meta.url).then((currentExports) => {
    RefreshRuntime.registerExportsForReactRefresh("E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx", currentExports);
    import.meta.hot.accept((nextExports) => {
      if (!nextExports) return;
      const invalidateMessage = RefreshRuntime.validateRefreshBoundaryAndEnqueueUpdate("E:/Do_an_Lap_Trinh_mang/NT106.Nhom7/frontend/src/components/Message.jsx", currentExports, nextExports);
      if (invalidateMessage) import.meta.hot.invalidate(invalidateMessage);
    });
  });
}

//# sourceMappingURL=data:application/json;base64,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QXVDLElBRXZDLHVCQUFDLFlBQVMsV0FBVSx5QkFBcEI7QUFBQTtBQUFBO0FBQUE7QUFBQSxpQkFBeUMsS0FKakQ7QUFBQTtBQUFBO0FBQUE7QUFBQSxpQkFNQTtBQUFBLFVBQ0EsdUJBQUMsU0FBSSxXQUFVLGlDQUNYO0FBQUEsbUNBQUMsVUFBSyxXQUFVLGdDQUErQixPQUFPVCxRQUFRMkYsb0JBQ3pEM0Ysa0JBQVEyRixzQkFBc0IsbUJBRG5DO0FBQUE7QUFBQTtBQUFBO0FBQUEsbUJBRUE7QUFBQSxZQUNBLHVCQUFDLFVBQUssV0FBVSxzQkFDWHZHLHlCQUFlWSxRQUFRb0csYUFBYSxDQUFDLEtBRDFDO0FBQUE7QUFBQTtBQUFBO0FBQUEsbUJBRUE7QUFBQSxlQU5KO0FBQUE7QUFBQTtBQUFBO0FBQUEsaUJBT0E7QUFBQSxhQWZKO0FBQUE7QUFBQTtBQUFBO0FBQUEsZUFnQkEsSUFHQTtBQUFBLFVBQUM7QUFBQTtBQUFBLFlBQ0c7QUFBQSxZQUNBO0FBQUEsWUFDQTtBQUFBO0FBQUEsVUFISjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsUUFHdUIsS0F6Qi9CO0FBQUE7QUFBQTtBQUFBO0FBQUEsZUE0QkE7QUFBQSxRQUNBLHVCQUFDLFNBQUksV0FBVSwrREFDVm5GLDJCQURMO0FBQUE7QUFBQTtBQUFBO0FBQUEsZUFFQTtBQUFBO0FBQUE7QUFBQSxJQXRESjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUF1REE7QUFFUjtBQUFFaEIsR0E1UElGLFNBQU87QUFBQSxVQUVReEIsY0FDRUEsY0FDRUMsY0FFS0EsY0FDR0EsY0FDUEEsWUFBWTtBQUFBO0FBQUE2SCxLQVJoQ3RHO0FBOFBOLGVBQWVBO0FBQVEsSUFBQXNHO0FBQUFDLGFBQUFELElBQUEiLCJuYW1lcyI6WyJ1c2VTdGF0ZSIsInVzZUNhbGxiYWNrIiwidXNlQXV0aFN0b3JlIiwidXNlQ2hhdFN0b3JlIiwiYXJyYXlCdWZmZXJUb0Jhc2U2NCIsImJhc2U2NFRvQXJyYXlCdWZmZXIiLCJmb3JtYXRNZXNzYWdlVGltZSIsIkpTRW5jcnlwdCIsInRvYXN0IiwiTG9hZGVyIiwiRG93bmxvYWQiLCJGaWxlVGV4dCIsIkZpbGVXYXJuaW5nIiwiVHJhc2gyIiwiRGVjcnlwdGVkTWVzc2FnZUNvbnRlbnQiLCJmb3JtYXRGaWxlU2l6ZSIsImJ5dGVzIiwiayIsInNpemVzIiwiaSIsIk1hdGgiLCJmbG9vciIsImxvZyIsInBhcnNlRmxvYXQiLCJwb3ciLCJ0b0ZpeGVkIiwiTWVzc2FnZSIsIm1lc3NhZ2UiLCJfcyIsImF1dGhVc2VyIiwic3RhdGUiLCJwcml2YXRlS2V5Iiwic2VsZWN0ZWRVc2VyIiwic2VsZWN0ZWRNZXNzYWdlSWQiLCJzZXRTZWxlY3RlZE1lc3NhZ2VJZCIsImRlbGV0ZU1lc3NhZ2UiLCJpc0Rvd25sb2FkaW5nIiwic2V0SXNEb3dubG9hZGluZyIsImlzU2VuZGVyIiwic2VuZGVySWQiLCJfaWQiLCJjaGF0Q2xhc3NOYW1lIiwiYnViYmxlQmdDb2xvciIsInByb2ZpbGVQaWMiLCJmb3JtYXR0ZWRUaW1lIiwiY3JlYXRlZEF0IiwiaXNTZWxlY3RlZCIsImNvbnNvbGUiLCJoYW5kbGVNZXNzYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJ3aW5kb3ciLCJjb25maXJtIiwiaGFuZGxlRG93bmxvYWRGaWxlIiwiaXNfZmlsZSIsImVycm9yIiwibG9hZGluZ1RvYXN0SWQiLCJsb2FkaW5nIiwiZW5jcnlwdGVkQWVzS2V5QmFzZTY0IiwiZGVjcnlwdGVkQWVzS2V5QmFzZTY0IiwiZmlsZUFlc0tleSIsImZpbGVfZW5jcnlwdGVkX2tleSIsInN1YnN0cmluZyIsImZpbGVfZW5jcnlwdGVkX2tleV9zZW5kZXIiLCJFcnJvciIsImRlY3J5cHRvciIsInNldFByaXZhdGVLZXkiLCJkZWNyeXB0IiwiYWVzS2V5QnVmZmVyIiwiY3J5cHRvIiwic3VidGxlIiwiaW1wb3J0S2V5IiwibmFtZSIsImZpbGVfaXYiLCJmaWxlSXYiLCJieXRlTGVuZ3RoIiwiaWQiLCJyZXNwb25zZSIsImZldGNoIiwiZmlsZV9wYXRoIiwiY3JlZGVudGlhbHMiLCJjb250ZW50VHlwZSIsImhlYWRlcnMiLCJnZXQiLCJzdGF0dXMiLCJzdGF0dXNUZXh0IiwiY29udGVudExlbmd0aCIsIm9rIiwiZXJyb3JUZXh0IiwidGV4dCIsInJlc3BvbnNlVGV4dCIsIndhcm4iLCJpbmNsdWRlcyIsImVuY3J5cHRlZEZpbGVCdWZmZXIiLCJhcnJheUJ1ZmZlciIsImRvd25sb2FkZWRCeXRlcyIsIlVpbnQ4QXJyYXkiLCJsZW5ndGgiLCJzbGljZSIsImZpcnN0Qnl0ZXNTdHIiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJhcHBseSIsImRlY3J5cHRlZEZpbGVCdWZmZXIiLCJpdiIsImJsb2IiLCJCbG9iIiwidHlwZSIsImZpbGVfdHlwZSIsInVybCIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsImEiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJocmVmIiwiZG93bmxvYWQiLCJvcmlnaW5hbF9maWxlX25hbWUiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJjbGljayIsInJlbW92ZUNoaWxkIiwicmV2b2tlT2JqZWN0VVJMIiwic3VjY2VzcyIsInN0YWNrIiwidW5kZWZpbmVkIiwiZmlsZV9zaXplIiwiX2MiLCIkUmVmcmVzaFJlZyQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsiTWVzc2FnZS5qc3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSwgdXNlTWVtbywgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7IC8vIEltcG9ydCB1c2VDYWxsYmFja1xuaW1wb3J0IHsgdXNlQXV0aFN0b3JlIH0gZnJvbSAnLi4vc3RvcmUvdXNlQXV0aFN0b3JlJztcbmltcG9ydCB7IHVzZUNoYXRTdG9yZSB9IGZyb20gJy4uL3N0b3JlL3VzZUNoYXRTdG9yZSc7XG5pbXBvcnQgeyBhcnJheUJ1ZmZlclRvQmFzZTY0LCBiYXNlNjRUb0FycmF5QnVmZmVyLCBmb3JtYXRNZXNzYWdlVGltZSB9IGZyb20gJy4uL2xpYi91dGlscyc7XG5pbXBvcnQgSlNFbmNyeXB0IGZyb20gJ2pzZW5jcnlwdCc7XG5pbXBvcnQgdG9hc3QgZnJvbSAncmVhY3QtaG90LXRvYXN0JztcbmltcG9ydCB7IExvYWRlciwgRG93bmxvYWQsIEZpbGVUZXh0LCBGaWxlV2FybmluZywgVHJhc2gyIH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcbmltcG9ydCBEZWNyeXB0ZWRNZXNzYWdlQ29udGVudCBmcm9tICcuL0RlY3J5cHRlZE1lc3NhZ2VDb250ZW50JztcblxuXG5jb25zdCBmb3JtYXRGaWxlU2l6ZSA9IChieXRlcykgPT4ge1xuICAgIGlmIChieXRlcyA9PT0gMCkgcmV0dXJuICcwIEJ5dGVzJztcbiAgICBjb25zdCBrID0gMTAyNDtcbiAgICBjb25zdCBzaXplcyA9IFsnQnl0ZXMnLCAnS0InLCAnTUInLCAnR0InLCAnVEInXTtcbiAgICBjb25zdCBpID0gTWF0aC5mbG9vcihNYXRoLmxvZyhieXRlcykgLyBNYXRoLmxvZyhrKSk7XG4gICAgcmV0dXJuIHBhcnNlRmxvYXQoKGJ5dGVzIC8gTWF0aC5wb3coaywgaSkpLnRvRml4ZWQoMSkpICsgJyAnICsgc2l6ZXNbaV07XG59O1xuXG5jb25zdCBNZXNzYWdlID0gKHsgbWVzc2FnZSB9KSA9PiB7XG5cbiAgICBjb25zdCBhdXRoVXNlciA9IHVzZUF1dGhTdG9yZSgoc3RhdGUpID0+IHN0YXRlLmF1dGhVc2VyKTtcbiAgICBjb25zdCBwcml2YXRlS2V5ID0gdXNlQXV0aFN0b3JlKChzdGF0ZSkgPT4gc3RhdGUucHJpdmF0ZUtleSk7XG4gICAgY29uc3Qgc2VsZWN0ZWRVc2VyID0gdXNlQ2hhdFN0b3JlKChzdGF0ZSkgPT4gc3RhdGUuc2VsZWN0ZWRVc2VyKTtcblxuICAgIGNvbnN0IHNlbGVjdGVkTWVzc2FnZUlkID0gdXNlQ2hhdFN0b3JlKChzdGF0ZSkgPT4gc3RhdGUuc2VsZWN0ZWRNZXNzYWdlSWQpO1xuICAgIGNvbnN0IHNldFNlbGVjdGVkTWVzc2FnZUlkID0gdXNlQ2hhdFN0b3JlKChzdGF0ZSkgPT4gc3RhdGUuc2V0U2VsZWN0ZWRNZXNzYWdlSWQpO1xuICAgIGNvbnN0IGRlbGV0ZU1lc3NhZ2UgPSB1c2VDaGF0U3RvcmUoKHN0YXRlKSA9PiBzdGF0ZS5kZWxldGVNZXNzYWdlKTtcblxuICAgIGNvbnN0IFtpc0Rvd25sb2FkaW5nLCBzZXRJc0Rvd25sb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcblxuICAgIGNvbnN0IGlzU2VuZGVyID0gbWVzc2FnZS5zZW5kZXJJZCA9PT0gYXV0aFVzZXI/Ll9pZDtcbiAgICBjb25zdCBjaGF0Q2xhc3NOYW1lID0gaXNTZW5kZXIgPyBcImNoYXQtZW5kXCIgOiBcImNoYXQtc3RhcnRcIjtcbiAgICBjb25zdCBidWJibGVCZ0NvbG9yID0gaXNTZW5kZXIgPyBcImJnLXNreS01MDBcIiA6IFwiYmctZ3JheS02MDBcIjtcblxuICAgIGNvbnN0IHByb2ZpbGVQaWMgPSBpc1NlbmRlciA/IGF1dGhVc2VyPy5wcm9maWxlUGljIDogc2VsZWN0ZWRVc2VyPy5wcm9maWxlUGljO1xuICAgIGNvbnN0IGZvcm1hdHRlZFRpbWUgPSBmb3JtYXRNZXNzYWdlVGltZShtZXNzYWdlLmNyZWF0ZWRBdCk7XG5cblxuICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSBzZWxlY3RlZE1lc3NhZ2VJZCA9PT0gbWVzc2FnZS5faWQ7XG5cblxuICAgIGNvbnNvbGUubG9nKGBbTWVzc2FnZSAke21lc3NhZ2UuX2lkfV0gUmVuZGVyLiBpc1NlbmRlcjogJHtpc1NlbmRlcn0sIHNlbGVjdGVkTWVzc2FnZUlkOiAke3NlbGVjdGVkTWVzc2FnZUlkfSwgaXNTZWxlY3RlZDogJHtpc1NlbGVjdGVkfWApO1xuXG5cbiAgICBjb25zdCBoYW5kbGVNZXNzYWdlQ2xpY2sgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG5cbiAgICAgICAgY29uc29sZS5sb2coYFtNZXNzYWdlICR7bWVzc2FnZS5faWR9XSBoYW5kbGVNZXNzYWdlQ2xpY2sgZmlyZWQuIGlzU2VuZGVyOiAke2lzU2VuZGVyfWApO1xuICAgICAgICBpZiAoaXNTZW5kZXIpIHtcbiAgICAgICAgICAgIHNldFNlbGVjdGVkTWVzc2FnZUlkKG1lc3NhZ2UuX2lkKTtcbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgc2V0U2VsZWN0ZWRNZXNzYWdlSWQobnVsbCk7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbTWVzc2FnZSAke21lc3NhZ2UuX2lkfV0gQ2xpY2tlZCByZWNlaXZlZCBtZXNzYWdlLCBjbGVhcmluZyBzZWxlY3Rpb24uYCk7XG4gICAgICAgIH1cbiAgICB9LCBbbWVzc2FnZS5faWQsIGlzU2VuZGVyLCBzZXRTZWxlY3RlZE1lc3NhZ2VJZF0pO1xuXG5cbiAgICBjb25zdCBoYW5kbGVEZWxldGVDbGljayA9IHVzZUNhbGxiYWNrKChlKSA9PiB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgY29uc29sZS5sb2coYFtNZXNzYWdlICR7bWVzc2FnZS5faWR9XSBoYW5kbGVEZWxldGVDbGljayBmaXJlZC5gKTtcbiAgICAgICAgaWYgKHdpbmRvdy5jb25maXJtKFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIG1lc3NhZ2U/XCIpKSB7XG4gICAgICAgICAgICBkZWxldGVNZXNzYWdlKG1lc3NhZ2UuX2lkKTtcbiAgICAgICAgfVxuICAgIH0sIFttZXNzYWdlLl9pZCwgZGVsZXRlTWVzc2FnZV0pO1xuXG5cbiAgICBjb25zdCBoYW5kbGVEb3dubG9hZEZpbGUgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XG4gICAgICAgIHNldFNlbGVjdGVkTWVzc2FnZUlkKG51bGwpO1xuICAgICAgICBpZiAoIW1lc3NhZ2UuaXNfZmlsZSB8fCAhcHJpdmF0ZUtleSkge1xuICAgICAgICAgICAgdG9hc3QuZXJyb3IoXCJDYW5ub3QgZG93bmxvYWQgZmlsZTogSW5mb3JtYXRpb24gbWlzc2luZyBvciBubyBwcml2YXRlIGtleS5cIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc2V0SXNEb3dubG9hZGluZyh0cnVlKTtcbiAgICAgICAgY29uc3QgbG9hZGluZ1RvYXN0SWQgPSB0b2FzdC5sb2FkaW5nKFwiU3RhcnRpbmcgZG93bmxvYWQuLi5cIik7XG5cbiAgICAgICAgbGV0IGVuY3J5cHRlZEFlc0tleUJhc2U2NCA9IG51bGw7XG4gICAgICAgIGxldCBkZWNyeXB0ZWRBZXNLZXlCYXNlNjQgPSBudWxsO1xuICAgICAgICBsZXQgZmlsZUFlc0tleSA9IG51bGw7XG4gICAgICAgIHRyeSB7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbaGFuZGxlRG93bmxvYWRGaWxlXSBDaGVja2luZyBrZXlzIGZvciBtZXNzYWdlICR7bWVzc2FnZS5faWR9OmApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYCAgLT4gaXNTZW5kZXI6ICR7aXNTZW5kZXJ9IChhdXRoVXNlcjogJHthdXRoVXNlcj8uX2lkfSwgbXNnU2VuZGVyOiAke21lc3NhZ2Uuc2VuZGVySWR9KWApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYCAgLT4gbWVzc2FnZS5maWxlX2VuY3J5cHRlZF9rZXkgKGZvciByZWNlaXZlcik6YCwgbWVzc2FnZS5maWxlX2VuY3J5cHRlZF9rZXkgPyBtZXNzYWdlLmZpbGVfZW5jcnlwdGVkX2tleS5zdWJzdHJpbmcoMCwgMzApICsgJy4uLicgOiAnTUlTU0lORy9OVUxMJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgICAtPiBtZXNzYWdlLmZpbGVfZW5jcnlwdGVkX2tleV9zZW5kZXIgKGZvciBzZW5kZXIpOmAsIG1lc3NhZ2UuZmlsZV9lbmNyeXB0ZWRfa2V5X3NlbmRlciA/IG1lc3NhZ2UuZmlsZV9lbmNyeXB0ZWRfa2V5X3NlbmRlci5zdWJzdHJpbmcoMCwgMzApICsgJy4uLicgOiAnTUlTU0lORy9OVUxMJyk7XG5cbiAgICAgICAgICAgIGVuY3J5cHRlZEFlc0tleUJhc2U2NCA9IGlzU2VuZGVyID8gbWVzc2FnZS5maWxlX2VuY3J5cHRlZF9rZXlfc2VuZGVyIDogbWVzc2FnZS5maWxlX2VuY3J5cHRlZF9rZXk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW2hhbmRsZURvd25sb2FkRmlsZV0gQXNzaWduZWQgZW5jcnlwdGVkQWVzS2V5QmFzZTY0ID0gJHtlbmNyeXB0ZWRBZXNLZXlCYXNlNjQgPyBlbmNyeXB0ZWRBZXNLZXlCYXNlNjQuc3Vic3RyaW5nKDAsIDMwKSArICcuLi4nIDogJ0ZBTFNZJ31gKTtcblxuICAgICAgICAgICAgaWYgKCFlbmNyeXB0ZWRBZXNLZXlCYXNlNjQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIGVuY3J5cHRlZCBBRVMga2V5IGZvciB0aGUgZmlsZS5cIik7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgY29uc3QgZGVjcnlwdG9yID0gbmV3IEpTRW5jcnlwdCgpO1xuICAgICAgICAgICAgZGVjcnlwdG9yLnNldFByaXZhdGVLZXkocHJpdmF0ZUtleSk7XG4gICAgICAgICAgICBkZWNyeXB0ZWRBZXNLZXlCYXNlNjQgPSBkZWNyeXB0b3IuZGVjcnlwdChlbmNyeXB0ZWRBZXNLZXlCYXNlNjQpO1xuXG4gICAgICAgICAgICBpZiAoZGVjcnlwdGVkQWVzS2V5QmFzZTY0ID09PSBmYWxzZSB8fCBkZWNyeXB0ZWRBZXNLZXlCYXNlNjQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbaGFuZGxlRG93bmxvYWRGaWxlXSBSU0EgRGVjcnlwdGlvbiBGQUlMRUQhIGRlY3J5cHQoKSByZXR1cm5lZDogJHtkZWNyeXB0ZWRBZXNLZXlCYXNlNjR9YCk7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUlNBIERlY3J5cHRpb24gRmFpbGVkLiBDYW5ub3QgcmV0cmlldmUgQUVTIGtleS5cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGFlc0tleUJ1ZmZlciA9IGJhc2U2NFRvQXJyYXlCdWZmZXIoZGVjcnlwdGVkQWVzS2V5QmFzZTY0KTtcbiAgICAgICAgICAgIGZpbGVBZXNLZXkgPSBhd2FpdCBjcnlwdG8uc3VidGxlLmltcG9ydEtleShcbiAgICAgICAgICAgICAgICBcInJhd1wiLCBhZXNLZXlCdWZmZXIsIHsgbmFtZTogXCJBRVMtR0NNXCIgfSwgdHJ1ZSwgW1wiZGVjcnlwdFwiXVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJbaGFuZGxlRG93bmxvYWRGaWxlXSBJbXBvcnRlZCBmaWxlQWVzS2V5IG9iamVjdDpcIiwgZmlsZUFlc0tleSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIltoYW5kbGVEb3dubG9hZEZpbGVdIERlY3J5cHRlZCBBRVMgS2V5IChCYXNlNjQgZm9yIGltcG9ydCk6XCIsIGRlY3J5cHRlZEFlc0tleUJhc2U2NCk7XG5cblxuICAgICAgICAgICAgaWYgKCFtZXNzYWdlLmZpbGVfaXYpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIGZpbGUgSVYgaW4gbWVzc2FnZSBkYXRhLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW2hhbmRsZURvd25sb2FkRmlsZV0gRmlsZSBJViAoQmFzZTY0IGZyb20gbWVzc2FnZS5maWxlX2l2KTpcIik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhtZXNzYWdlLmZpbGVfaXYpO1xuICAgICAgICAgICAgY29uc3QgZmlsZUl2ID0gYmFzZTY0VG9BcnJheUJ1ZmZlcihtZXNzYWdlLmZpbGVfaXYpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJbaGFuZGxlRG93bmxvYWRGaWxlXSBGaWxlIElWIEFycmF5QnVmZmVyIGxlbmd0aDpcIiwgZmlsZUl2LmJ5dGVMZW5ndGgpO1xuXG5cbiAgICAgICAgICAgIHRvYXN0LmxvYWRpbmcoXCJEb3dubG9hZGluZyBlbmNyeXB0ZWQgZmlsZS4uLlwiLCB7IGlkOiBsb2FkaW5nVG9hc3RJZCB9KTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYC9hcGkvZmlsZXMvZG93bmxvYWQvJHttZXNzYWdlLmZpbGVfcGF0aH1gLCB7XG4gICAgICAgICAgICAgICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJ1xuICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgICAgY29uc3QgY29udGVudFR5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnY29udGVudC10eXBlJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIltoYW5kbGVEb3dubG9hZEZpbGVdIFJlc3BvbnNlIGhlYWRlcnM6XCIsIHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiByZXNwb25zZS5zdGF0dXNUZXh0LFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBjb250ZW50VHlwZSxcbiAgICAgICAgICAgICAgICBjb250ZW50TGVuZ3RoOiByZXNwb25zZS5oZWFkZXJzLmdldCgnY29udGVudC1sZW5ndGgnKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIltoYW5kbGVEb3dubG9hZEZpbGVdIFNlcnZlciBlcnJvciByZXNwb25zZTpcIiwge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VUZXh0OiBlcnJvclRleHQuc3Vic3RyaW5nKDAsIDIwMCkgKyAnLi4uJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgU2VydmVyIHJldHVybmVkIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGlmICghY29udGVudFR5cGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJbaGFuZGxlRG93bmxvYWRGaWxlXSBNaXNzaW5nIGNvbnRlbnQtdHlwZSBoZWFkZXJcIik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFjb250ZW50VHlwZS5pbmNsdWRlcygnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJykpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFtoYW5kbGVEb3dubG9hZEZpbGVdIFVuZXhwZWN0ZWQgY29udGVudC10eXBlOiAke2NvbnRlbnRUeXBlfSwgYnV0IHByb2NlZWRpbmcgYW55d2F5YCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGVuY3J5cHRlZEZpbGVCdWZmZXIgPSBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJbaGFuZGxlRG93bmxvYWRGaWxlXSBFbmNyeXB0ZWQgZmlsZSBidWZmZXIgc2l6ZTpcIiwgZW5jcnlwdGVkRmlsZUJ1ZmZlci5ieXRlTGVuZ3RoKTtcblxuXG4gICAgICAgICAgICBjb25zdCBkb3dubG9hZGVkQnl0ZXMgPSBuZXcgVWludDhBcnJheShlbmNyeXB0ZWRGaWxlQnVmZmVyKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbaGFuZGxlRG93bmxvYWRGaWxlXSBEb3dubG9hZGVkIEJ1ZmZlciAoJHtkb3dubG9hZGVkQnl0ZXMubGVuZ3RofSBieXRlcykgU3RhcnQ6YCwgZG93bmxvYWRlZEJ5dGVzLnNsaWNlKDAsIDE2KSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW2hhbmRsZURvd25sb2FkRmlsZV0gRG93bmxvYWRlZCBCdWZmZXIgRW5kOmAsIGRvd25sb2FkZWRCeXRlcy5zbGljZSgtMTYpKTtcblxuXG4gICAgICAgICAgICBjb25zdCBmaXJzdEJ5dGVzU3RyID0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBkb3dubG9hZGVkQnl0ZXMuc2xpY2UoMCwgMjApKTtcbiAgICAgICAgICAgIGlmIChmaXJzdEJ5dGVzU3RyLmluY2x1ZGVzKCc8IURPQ1RZUEUnKSB8fCBmaXJzdEJ5dGVzU3RyLmluY2x1ZGVzKCc8aHRtbCcpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW2hhbmRsZURvd25sb2FkRmlsZV0gUmVjZWl2ZWQgSFRNTCBpbnN0ZWFkIG9mIGJpbmFyeSBkYXRhOicsIGZpcnN0Qnl0ZXNTdHIpO1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2VydmVyIHJldHVybmVkIEhUTUwgaW5zdGVhZCBvZiBmaWxlIGRhdGEuIFBsZWFzZSBjaGVjayBzZXJ2ZXIgbG9ncy4nKTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICB0b2FzdC5sb2FkaW5nKFwiRGVjcnlwdGluZyBmaWxlLi4uXCIsIHsgaWQ6IGxvYWRpbmdUb2FzdElkIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJbaGFuZGxlRG93bmxvYWRGaWxlXSBBdHRlbXB0aW5nIGNyeXB0by5zdWJ0bGUuZGVjcnlwdC4uLlwiKTtcbiAgICAgICAgICAgIGNvbnN0IGRlY3J5cHRlZEZpbGVCdWZmZXIgPSBhd2FpdCBjcnlwdG8uc3VidGxlLmRlY3J5cHQoXG4gICAgICAgICAgICAgICAgeyBuYW1lOiBcIkFFUy1HQ01cIiwgaXY6IGZpbGVJdiB9LFxuICAgICAgICAgICAgICAgIGZpbGVBZXNLZXksXG4gICAgICAgICAgICAgICAgZW5jcnlwdGVkRmlsZUJ1ZmZlclxuICAgICAgICAgICAgKTtcblxuXG4gICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2RlY3J5cHRlZEZpbGVCdWZmZXJdLCB7IHR5cGU6IG1lc3NhZ2UuZmlsZV90eXBlIHx8ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nIH0pO1xuICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICAgICAgICBhLmhyZWYgPSB1cmw7XG4gICAgICAgICAgICBhLmRvd25sb2FkID0gbWVzc2FnZS5vcmlnaW5hbF9maWxlX25hbWUgfHwgJ2Rvd25sb2FkZWRfZmlsZSc7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpO1xuICAgICAgICAgICAgYS5jbGljaygpO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhKTtcbiAgICAgICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwodXJsKTtcblxuICAgICAgICAgICAgdG9hc3Quc3VjY2VzcyhcIkZpbGUgZG93bmxvYWRlZCBhbmQgZGVjcnlwdGVkIVwiLCB7IGlkOiBsb2FkaW5nVG9hc3RJZCB9KTtcblxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIi0tLSBFcnJvciBkb3dubG9hZGluZy9kZWNyeXB0aW5nIGZpbGUgLS0tXCIpO1xuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgTmFtZTpcIiwgZXJyb3IubmFtZSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIE1lc3NhZ2U6XCIsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJNZXNzYWdlIElEOlwiLCBtZXNzYWdlLl9pZCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlVzZWQgRGVjcnlwdGVkIEFFUyBLZXkgKEJhc2U2NCk6XCIsIGRlY3J5cHRlZEFlc0tleUJhc2U2NCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkltcG9ydGVkIGZpbGVBZXNLZXkgb2JqZWN0IChhdCB0aW1lIG9mIGVycm9yKTpcIiwgZmlsZUFlc0tleSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlVzZWQgSVYgKEJhc2U2NCBmcm9tIG1zZy5maWxlX2l2KTpcIiwgbWVzc2FnZS5maWxlX2l2KTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgU3RhY2s6XCIsIGVycm9yLnN0YWNrKTtcbiAgICAgICAgICAgICAgICB0b2FzdC5lcnJvcihgRG93bmxvYWQgZmFpbGVkOiAke2Vycm9yLm5hbWV9IC0gJHtlcnJvci5tZXNzYWdlfWAsIHsgaWQ6IGxvYWRpbmdUb2FzdElkIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ2F1Z2h0IG5vbi1FcnJvciBvYmplY3Q6XCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICB0b2FzdC5lcnJvcihgRG93bmxvYWQgZmFpbGVkIGR1ZSB0byBhbiB1bmV4cGVjdGVkIGVycm9yLiBDaGVjayBjb25zb2xlLmAsIHsgaWQ6IGxvYWRpbmdUb2FzdElkIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIi0tLSBFbmQgRXJyb3IgRGV0YWlscyAtLS1cIik7XG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICBzZXRJc0Rvd25sb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgICAgIHNldFNlbGVjdGVkTWVzc2FnZUlkKG51bGwpO1xuICAgICAgICB9XG4gICAgfSwgW21lc3NhZ2UsIHByaXZhdGVLZXksIGlzU2VuZGVyLCBzZXRTZWxlY3RlZE1lc3NhZ2VJZF0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgICAgPGRpdlxuICAgICAgICAgICAgY2xhc3NOYW1lPXtgY2hhdCAke2NoYXRDbGFzc05hbWV9IHJlbGF0aXZlIGdyb3VwICR7aXNTZW5kZXIgPyAnY3Vyc29yLXBvaW50ZXInIDogJyd9YH1cbiAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZU1lc3NhZ2VDbGlja31cbiAgICAgICAgPlxuICAgICAgICAgICAgey8qIERlbGV0ZSBCdXR0b24gLSBTaG93IG9ubHkgZm9yIHNlbmRlcidzIG1lc3NhZ2VzIHdoZW4gc2VsZWN0ZWQgKyBob3ZlcmVkICovfVxuICAgICAgICAgICAge2lzU2VuZGVyICYmIGlzU2VsZWN0ZWQgJiYgKFxuICAgICAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17aGFuZGxlRGVsZXRlQ2xpY2t9XG5cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgYWJzb2x1dGUgJHtpc1NlbmRlciA/ICdyaWdodC1bY2FsYygyLjVyZW0rMC41cmVtKV0nIDogJ2xlZnQtW2NhbGMoMi41cmVtKzAuNXJlbSldJ30gdG9wLTEvMiB0cmFuc2Zvcm0gLXRyYW5zbGF0ZS15LTEvMlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAtMS41IHJvdW5kZWQtZnVsbCBiZy1yZWQtNTAwIGhvdmVyOmJnLXJlZC02MDAgdGV4dC13aGl0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHktMCBncm91cC1ob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkgZHVyYXRpb24tMjAwIHotMTBgfVxuICAgICAgICAgICAgICAgICAgICB0aXRsZT1cIkRlbGV0ZSBNZXNzYWdlXCJcbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIDxUcmFzaDIgc2l6ZT17MTh9IC8+XG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICApfVxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImNoYXQtaW1hZ2UgYXZhdGFyXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3LTEwIHJvdW5kZWQtZnVsbFwiPlxuICAgICAgICAgICAgICAgICAgICA8aW1nIGFsdD1cIlVzZXIgYXZhdGFyXCIgc3JjPXtwcm9maWxlUGljIHx8IFwiL2F2YXRhci5wbmdcIn0gLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2BjaGF0LWJ1YmJsZSAke2J1YmJsZUJnQ29sb3J9IHRleHQtd2hpdGUgcGItMiBweC0zIGJyZWFrLXdvcmRzYH0+XG4gICAgICAgICAgICAgICAgey8qIC0tLSBQcmlvcml0aXplIEZpbGUgTWVzc2FnZSBSZW5kZXJpbmcgLS0tICovfVxuICAgICAgICAgICAgICAgIHttZXNzYWdlLmlzX2ZpbGUgPT09IHRydWUgPyAoXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTMgcC0yXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eyFpc0Rvd25sb2FkaW5nID8gaGFuZGxlRG93bmxvYWRGaWxlIDogdW5kZWZpbmVkfSBkaXNhYmxlZD17aXNEb3dubG9hZGluZ30gY2xhc3NOYW1lPVwiZmxleC1zaHJpbmstMCBwLTEgcm91bmRlZCBob3ZlcjpiZy1ibGFjay8yMFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtpc0Rvd25sb2FkaW5nID8gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8TG9hZGVyIGNsYXNzTmFtZT1cInNpemUtNiBhbmltYXRlLXNwaW5cIiAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxEb3dubG9hZCBjbGFzc05hbWU9XCJzaXplLTYgdGV4dC1za3ktMzAwXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1jb2wgb3ZlcmZsb3ctaGlkZGVuXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwidGV4dC1zbSBmb250LW1lZGl1bSB0cnVuY2F0ZVwiIHRpdGxlPXttZXNzYWdlLm9yaWdpbmFsX2ZpbGVfbmFtZX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttZXNzYWdlLm9yaWdpbmFsX2ZpbGVfbmFtZSB8fCBcIkF0dGFjaGVkIEZpbGVcIn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwidGV4dC14cyBvcGFjaXR5LTcwXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtmb3JtYXRGaWxlU2l6ZShtZXNzYWdlLmZpbGVfc2l6ZSB8fCAwKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgKSA6IChcblxuICAgICAgICAgICAgICAgICAgICA8RGVjcnlwdGVkTWVzc2FnZUNvbnRlbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U9e21lc3NhZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICBwcml2YXRlS2V5PXtwcml2YXRlS2V5fVxuICAgICAgICAgICAgICAgICAgICAgICAgaXNTZW5kZXI9e2lzU2VuZGVyfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY2hhdC1mb290ZXIgb3BhY2l0eS01MCB0ZXh0LXhzIGZsZXggZ2FwLTEgaXRlbXMtY2VudGVyIG10LTFcIj5cbiAgICAgICAgICAgICAgICB7Zm9ybWF0dGVkVGltZX1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICApO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgTWVzc2FnZTsiXSwiZmlsZSI6IkU6L0RvX2FuX0xhcF9UcmluaF9tYW5nL05UMTA2Lk5ob203L2Zyb250ZW5kL3NyYy9jb21wb25lbnRzL01lc3NhZ2UuanN4In0=